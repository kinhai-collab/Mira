service: mira-backend

provider:
  name: aws
  runtime: python3.9
  region: us-east-2
  stage: ${opt:stage, 'dev'}
  environment:
    STAGE: ${self:provider.stage}
    SUPABASE_URL: https://oxozhsomntvuyrurfzre.supabase.co/
    SUPABASE_KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94b3poc29tbnR2dXlydXJmenJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0NjczNDAsImV4cCI6MjA3NjA0MzM0MH0.kXO2FS3sTV3jpT1A8dzr0sr8Md2VM80dbG2uzOnG6_c
    FRONTEND_URL: https://main.dd480r9y8ima.amplifyapp.com/  
plugins:
  - serverless-python-requirements

custom:
  pythonRequirements:
    dockerizePip: true
    slim: true
    strip: false

functions:
  api:
    handler: lambda_handler.handler
    events:
      - http:
          path: /{proxy+}
          method: ANY
          cors:
            origin: '*'
            headers:
              - Content-Type
              - X-Amz-Date
              - Authorization
              - X-Api-Key
              - X-Amz-Security-Token
              - X-Amz-User-Agent
              - X-Amzn-Trace-Id
            allowCredentials: false
      - http:
          path: /
          method: ANY
          cors:
            origin: '*'
            headers:
              - Content-Type
              - X-Amz-Date
              - Authorization
              - X-Api-Key
              - X-Amz-Security-Token
              - X-Amz-User-Agent
              - X-Amzn-Trace-Id
            allowCredentials: false

package:
  exclude:
    - .git/**
    - .gitignore
    - README.md
    - __pycache__/**
    - "*.pyc"
    - "*.pyo"
